name: telegram message
on:
  release:
    types: [published]
    
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    
    - name: Build Changelog
      id: github_release
      uses: mikepenz/release-changelog-builder-action@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Format changelog for the message
      id: format_changelog
      uses: kaskar2008/action-release-to-telegram@v0.0.6
      with:
        template: .github/tg-message.mustache
        service-name: ATA Updates
        tag: NEW_TAG
        changelog: ${{ steps.github_release.outputs.changelog }}

    - name: Send technical release message to Telegram
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_TO }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        args: ${{ steps.format_changelog.outputs.message }}
        format: 'markdown'
